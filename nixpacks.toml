[phases.setup]
aptPkgs = ["libgl1", "libglib2.0-0"]

[phases.install]
cmds = [
  "python -m venv /opt/venv",
  ". /opt/venv/bin/activate && pip install --no-cache-dir -r requirements.txt"
]

[phases.build]
cmds = [
  ". /opt/venv/bin/activate && (pip uninstall -y opencv-python tensorboard 2>/dev/null || true)",
  "find /opt/venv -type d -name 'tests' -o -name 'test' -o -name '__pycache__' | xargs rm -rf",
  "find /opt/venv -name '*.pyc' -o -name '*.pyo' -delete",
  "rm -rf /opt/venv/lib/python3.11/site-packages/torch/test",
  "rm -rf /opt/venv/lib/python3.11/site-packages/tensorflow/include"
]
